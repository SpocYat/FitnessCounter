<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spocademy Fitness Journey</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
            color: #1e293b;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }
        
        .language-toggle {
            position: absolute;
            top: 15px;
            left: 20px;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .lang-btn {
            padding: 8px 16px;
            border: 2px solid rgba(255, 255, 255, 0.5);
            background: transparent;
            color: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .lang-btn.active {
            background: white;
            color: #3b82f6;
            border-color: white;
        }
        
        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }
        
        .brand {
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 10px;
            color: white;
        }
        
        .tagline {
            font-size: 18px;
            color: rgba(255, 255, 255, 0.9);
        }

        /* Today's Date Highlight */
        .today-highlight {
            background: linear-gradient(135deg, #10b981, #059669);
            padding: 15px 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .today-date {
            font-size: 20px;
            font-weight: 700;
            color: white;
            margin-bottom: 5px;
        }
        
        .today-day {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.9);
        }

        /* Main Page Stats - Reorganized */
        .main-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            min-width: 150px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #3b82f6;
        }
        
        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 8px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #64748b;
            font-weight: 500;
        }

        /* Top stats (Days completed and Streak) */
        .top-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        /* Bottom stats (other metrics) */
        .bottom-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 40px;
            flex-wrap: wrap;
        }
        
        /* Path UI Improvement */
        .track-container {
            position: relative;
            margin: 40px 0;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 2px solid #e2e8f0;
        }
        
        .path-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .day-milestone {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .day-milestone:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
        }
        
        .day-milestone.completed {
            background: linear-gradient(135deg, #10b981, #059669);
            border-color: #10b981;
            color: white;
        }
        
        .day-milestone.current {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            border-color: #f59e0b;
            color: white;
            animation: pulse 2s infinite;
        }
        
        .day-milestone.locked {
            opacity: 0.4;
            cursor: not-allowed;
            background: #f8fafc;
            color: #94a3b8;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(245, 158, 11, 0); }
            100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0); }
        }
        
        .day-number {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .day-progress-text {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .day-progress-ring {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 30px;
            height: 30px;
        }
        
        .fitness-tracker {
            display: none;
        }

        /* Task Page Styles */
        .fitness-tracker { 
            display: block; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%); 
            z-index: 2000; 
            overflow-y: auto; 
        }
        .return-btn { 
            position: fixed; 
            top: 20px; 
            left: 20px; 
            z-index: 1001; 
            background: #ef4444; 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 10px; 
            cursor: pointer; 
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        .return-btn:hover {
            background: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }
        .return-btn:active {
            transform: translateY(0px);
        }
        .fitness-container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
            padding-top: 120px;
        }
        .fitness-header { 
            text-align: center; 
            margin-bottom: 30px; 
            background: linear-gradient(135deg, #3b82f6, #1d4ed8); 
            padding: 25px; 
            border-radius: 20px; 
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.15); 
            color: white;
            position: relative;
        }

        /* Language toggle for task page - repositioned */
        .fitness-header .language-toggle {
            position: absolute;
            bottom: 15px;
            right: 20px;
        }

        .fitness-brand { 
            font-size: 32px; 
            font-weight: 700; 
            margin-bottom: 10px; 
        }
        .plan-text {
            font-size: 18px;
            font-weight: 500;
        }
        
        /* Floating Progress Bar - Repositioned to bottom */
        .floating-progress {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px 30px;
            border-radius: 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            border: 2px solid #e2e8f0;
            min-width: 280px;
            text-align: center;
        }
        
        .progress-text {
            font-size: 16px;
            font-weight: 600;
            color: #3b82f6;
            margin-bottom: 8px;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .tasks-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); 
            gap: 25px; 
            margin-bottom: 100px; /* Added bottom margin for floating progress bar */
        }
        .task-card { 
            background: white; 
            border-radius: 20px; 
            padding: 30px; 
            border: 2px solid #e2e8f0; 
            transition: all 0.4s ease; 
            position: relative; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        .task-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #3b82f6;
        }
        .task-card.completed { 
            border-color: #10b981; 
            background: linear-gradient(135deg, #10b981, #059669); 
            color: white;
        }
        .task-card.completed .task-title,
        .task-card.completed .task-info,
        .task-card.completed .task-description {
            color: white;
        }
        .task-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 15px; 
        }
        .task-title { 
            font-size: 24px; 
            font-weight: 700; 
            color: #1e293b; 
        }
        .task-status { 
            width: 35px; 
            height: 35px; 
            border-radius: 50%; 
            border: 3px solid #10b981; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 18px; 
            font-weight: bold; 
            color: #10b981;
        }
        .task-status.completed { 
            background: #10b981; 
            color: white; 
        }
        .task-info { 
            margin-bottom: 12px; 
            color: #64748b; 
            font-size: 16px;
            font-weight: 600;
        }
        .task-description {
            margin-bottom: 15px;
            color: #475569;
            font-size: 15px;
            line-height: 1.4;
        }
        .set-tracker {
            display: flex;
            gap: 8px;
            margin-bottom: 18px;
            justify-content: center;
        }
        .set-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #e2e8f0;
            border: 2px solid #cbd5e1;
            transition: all 0.3s ease;
        }
        .set-dot.completed {
            background: #10b981;
            border-color: #10b981;
        }
        .set-dot.current {
            background: #3b82f6;
            border-color: #3b82f6;
            animation: pulse-dot 1.5s infinite;
        }
        @keyframes pulse-dot {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }
        .task-actions { 
            display: flex; 
            gap: 12px; 
            flex-wrap: wrap; 
        }
        .btn { 
            padding: 14px 22px; 
            border: none; 
            border-radius: 12px; 
            cursor: pointer; 
            font-size: 15px; 
            font-weight: 600; 
            transition: all 0.3s ease; 
            position: relative;
            overflow: hidden;
        }
        .btn:active {
            transform: scale(0.95);
        }
        .primary-btn { 
            background: linear-gradient(135deg, #3b82f6, #1d4ed8); 
            color: white; 
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        .secondary-btn { 
            background: white; 
            color: #3b82f6; 
            border: 2px solid #3b82f6; 
        }
        .secondary-btn:hover {
            background: #3b82f6;
            color: white;
            transform: translateY(-2px);
        }
        .manual-btn { 
            background: #64748b; 
            color: white; 
            font-size: 13px; 
            padding: 10px 16px; 
        }
        .manual-btn:hover {
            background: #475569;
            transform: translateY(-2px);
        }

        /* Audio Button Styles */
        .audio-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #3b82f6;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .audio-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: scale(1.05);
        }
        .task-card.completed .audio-btn {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            color: white;
        }
        .task-card.completed .audio-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Rest Timer for Running - Enhanced */
        .rest-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            color: white;
            text-align: center;
        }
        .rest-content {
            background: #1e293b;
            padding: 40px;
            border-radius: 20px;
            border: 3px solid #3b82f6;
        }
        .rest-heading {
            font-size: 24px;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 20px;
        }
        .rest-timer-big {
            font-size: 72px;
            font-weight: 700;
            margin: 20px 0;
            color: #3b82f6;
        }
        .rest-subtext {
            font-size: 18px;
            color: #94a3b8;
            margin-top: 15px;
        }

        /* Camera and Exercise Styles */
        .camera-section { 
            display: none; 
            background: rgba(248, 250, 252, 0.98); 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            z-index: 1500; 
            padding: 20px; 
            backdrop-filter: blur(10px);
            overflow-y: auto;
        }
        .camera-container { 
            max-width: 900px; 
            margin: 20px auto; 
            text-align: center; 
            background: white; 
            border-radius: 25px; 
            padding: 30px; 
            border: 2px solid #e2e8f0; 
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        .camera-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .camera-close:hover {
            background: #dc2626;
            transform: scale(1.1);
        }
        .exercise-demo {
            margin-bottom: 20px;
        }
        .demo-video {
            width: 300px;
            height: 200px;
            border-radius: 15px;
            margin: 0 10px;
            border: 2px solid #3b82f6;
        }
        .exercise-counter { 
            font-size: 56px; 
            color: #3b82f6; 
            margin: 20px 0; 
            font-weight: 700; 
        }
        .set-info {
            font-size: 24px;
            color: #10b981;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .target-info { 
            font-size: 28px; 
            margin-bottom: 20px; 
            color: #1e293b; 
            font-weight: 600;
        }
        .exercise-status { 
            font-size: 20px; 
            color: #64748b; 
            margin-bottom: 20px; 
            min-height: 30px; 
        }
        .rest-timer {
            font-size: 48px;
            color: #ef4444;
            font-weight: 700;
            margin: 20px 0;
        }
        #videoElement { 
            width: 100%; 
            max-width: 640px; 
            border: 4px solid #3b82f6; 
            border-radius: 15px; 
        }
        .video-container { 
            position: relative; 
            display: inline-block; 
            margin: 25px 0; 
        }
        #canvas {
            position: absolute;
            top: 4px;
            left: 50%;
            transform: translateX(-50%);
            pointer-events: none;
            border-radius: 11px;
        }
        .completion-message { 
            display: none; 
            background: linear-gradient(135deg, #10b981, #059669); 
            color: white; 
            padding: 20px; 
            border-radius: 15px; 
            margin: 20px 0; 
            font-size: 24px; 
            font-weight: 700; 
        }
        .congratulations { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(248, 250, 252, 0.98); 
            z-index: 2500; 
            align-items: center; 
            justify-content: center; 
            flex-direction: column; 
            text-align: center; 
            backdrop-filter: blur(10px);
        }
        .congrats-content { 
            max-width: 600px; 
            padding: 50px; 
            background: white; 
            border-radius: 25px; 
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
            border: 2px solid #e2e8f0;
        }
        .congrats-title { 
            font-size: 48px; 
            color: #10b981; 
            margin-bottom: 20px; 
            font-weight: 700;
        }
        .congrats-content h2 {
            color: #1e293b;
            margin-bottom: 20px;
        }
        .congrats-content p {
            color: #64748b;
        }

        .footer-text {
            text-align: center;
            margin-top: 30px;
            font-size: 14px;
            color: #64748b;
        }

        /* Success Animation */
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .success-animation {
            animation: successPulse 0.6s ease-in-out;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .floating-progress {
                bottom: 15px;
                left: 15px;
                right: 15px;
                transform: none;
                min-width: auto;
            }
            
            .tasks-grid {
                margin-bottom: 80px;
            }
            
            .language-toggle {
                position: static;
                justify-content: center;
                margin-bottom: 15px;
            }
            
            .fitness-header .language-toggle {
                position: static;
                justify-content: center;
                margin-top: 15px;
            }
            
            .demo-video {
                width: 250px;
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <!-- Main Page (Landing Page) -->
    <div id="progressPage">
        <div class="container">
            <div class="header">
                <div class="language-toggle">
                    <button class="lang-btn active" onclick="setLanguage('en')" id="langEn">English</button>
                    <button class="lang-btn" onclick="setLanguage('mr')" id="langMr">मराठी</button>
                </div>
                <div class="brand">🏃‍♂️ Spocademy <span data-translate="fitness-journey">FITNESS JOURNEY</span></div>
                <div class="tagline" data-translate="tagline">Your 30-Day Transformation Challenge</div>
            </div>
            
            <!-- Today's Date Highlight -->
            <div class="today-highlight">
                <div class="today-date" id="todayDate">Today is Monday, January 15, 2024</div>
                <div class="today-day" id="todayDay">Ready to crush your fitness goals?</div>
            </div>
            
            <!-- Top Stats (Days completed and Streak above the path) -->
            <div class="top-stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalDaysCompleted">0</div>
                    <div class="stat-label" data-translate="days-completed">Days Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="currentStreakDisplay">0</div>
                    <div class="stat-label" data-translate="current-streak">Current Streak</div>
                </div>
            </div>
            
            <!-- Improved Path UI -->
            <div class="track-container">
                <h2 style="text-align: center; margin-bottom: 30px; color: #1e293b;" data-translate="journey-path">Your Fitness Journey Path</h2>
                <div class="path-grid" id="pathGrid">
                    <!-- Days will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Bottom Stats (other metrics below the path) -->
            <div class="bottom-stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalActivitiesDisplay">0</div>
                    <div class="stat-label" data-translate="total-activities">Total Activities</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="completionPercentage">0%</div>
                    <div class="stat-label" data-translate="overall-progress">Overall Progress</div>
                </div>
            </div>
            
            <div class="footer-text">
                <strong>Powered by Spocademy</strong> - <span data-translate="transforming-lives">Transforming Lives Through Fitness</span>
            </div>
        </div>
    </div>

    <!-- Task Page -->
    <div id="fitnessTracker" class="fitness-tracker">
        <!-- MediaPipe Scripts - Moved to top for better loading -->
        <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js" crossorigin="anonymous"></script>

        <button class="return-btn" onclick="returnToMain()" data-translate="back-journey">← Back to Journey</button>
        
        <!-- Floating Progress Bar (moved to bottom) -->
        <div class="floating-progress">
            <div class="progress-text" id="floatingProgressText" data-translate="tasks-complete">0/4 Tasks Complete</div>
            <div class="progress-bar">
                <div class="progress-fill" id="floatingProgressBar"></div>
            </div>
        </div>
        
        <div class="fitness-container">
            <div class="fitness-header">
                <div class="fitness-brand" data-translate="hello-yatin">Hello Yatin! 👋</div>
                <div class="plan-text" id="planText" data-translate="todays-plan">Here's your plan for Monday, January 15, 2024</div>
                <div class="language-toggle">
                    <button class="lang-btn active" onclick="setLanguage('en')" id="taskLangEn">English</button>
                    <button class="lang-btn" onclick="setLanguage('mr')" id="taskLangMr">मराठी</button>
                </div>
            </div>
            
            <div class="tasks-grid">
                <div class="task-card" id="task1">
                    <button class="audio-btn" onclick="speakTaskContent(1)" data-translate="speak-task">🔊 Listen</button>
                    <div class="task-header">
                        <div class="task-title" data-translate="runs-title">🏃‍♂️ 200m Run</div>
                        <div class="task-status" id="status1">○</div>
                    </div>
                    <div class="task-info" data-translate="runs-info">Run 5 rounds of 200-meters</div>
                    <div class="task-description" data-translate="runs-desc">Run 200 meters at your own pace. Focus on maintaining good form and breathing rhythm.</div>
                    <div class="task-actions">
                        <button class="btn primary-btn" onclick="markTaskComplete(1)" data-translate="mark-complete">✓ Mark Complete</button>
                    </div>
                </div>
                
                <div class="task-card" id="task2">
                    <button class="audio-btn" onclick="speakTaskContent(2)" data-translate="speak-task">🔊 Listen</button>
                    <div class="task-header">
                        <div class="task-title" data-translate="squats-title">🦵 Squats</div>
                        <div class="task-status" id="status2">○</div>
                    </div>
                    <div class="task-info" data-translate="squats-info">2 sets × 3 reps + 5 seconds rest</div>
                    <div class="task-description" data-translate="squats-desc">Perform squats with proper form. Our AI will track your movement and count reps automatically.</div>
                    <div class="set-tracker" id="setTracker2">
                        <div class="set-dot" id="set2-1"></div>
                        <div class="set-dot" id="set2-2"></div>
                    </div>
                    <div class="task-actions">
                        <button class="btn primary-btn" onclick="startExercise('squats', 3, 2, 2)" data-translate="start-camera">📹 Start</button>
                        <button class="btn manual-btn" onclick="markTaskComplete(2)" data-translate="manual-complete">Manual ✓</button>
                    </div>
                </div>
                
                <div class="task-card" id="task3">
                    <button class="audio-btn" onclick="speakTaskContent(3)" data-translate="speak-task">🔊 Listen</button>
                    <div class="task-header">
                        <div class="task-title" data-translate="jumping-jacks-title">🤸‍♂️ Jumping Jacks</div>
                        <div class="task-status" id="status3">○</div>
                    </div>
                    <div class="task-info" data-translate="jumping-jacks-info">2 sets × 3 reps + 5 seconds rest</div>
                    <div class="task-description" data-translate="jumping-jacks-desc">Do jumping jacks with arms and legs moving together. AI will detect and count your movements.</div>
                    <div class="set-tracker" id="setTracker3">
                        <div class="set-dot" id="set3-1"></div>
                        <div class="set-dot" id="set3-2"></div>
                    </div>
                    <div class="task-actions">
                        <button class="btn primary-btn" onclick="startExercise('jumping-jacks', 3, 2, 3)" data-translate="start-camera">📹 Start</button>
                        <button class="btn manual-btn" onclick="markTaskComplete(3)" data-translate="manual-complete">Manual ✓</button>
                    </div>
                </div>
                
                <div class="task-card" id="task4">
                    <button class="audio-btn" onclick="speakTaskContent(4)" data-translate="speak-task">🔊 Listen</button>
                    <div class="task-header">
                        <div class="task-title" data-translate="water-title">💧 Water Intake</div>
                        <div class="task-status" id="status4">○</div>
                    </div>
                    <div class="task-info" data-translate="water-info">3 liters throughout the day</div>
                    <div class="task-description" data-translate="water-desc">Stay hydrated by drinking water regularly. Aim for 3 liters spread throughout the day.</div>
                    <div class="task-actions">
                        <button class="btn primary-btn" onclick="markTaskComplete(4)" data-translate="mark-complete">✓ Mark Complete</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="camera-section" id="cameraSection">
            <div class="camera-container">
                <button class="camera-close" onclick="closeCamera()" title="Close">✕</button>
                <h2 id="exerciseTitle" data-translate="exercise-counter">Exercise Counter</h2>
                
                <!-- Exercise Demo Videos with YouTube embeds -->
                <div class="exercise-demo" id="exerciseDemo">
                    <div id="squatDemo" style="display: none;">
                        <p style="margin-bottom: 15px;" data-translate="follow-movement">Follow the movement:</p>
                        <iframe class="demo-video" src="https://www.youtube.com/embed/-5LhNSMBrEs" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                    <div id="jumpingJackDemo" style="display: none;">
                        <p style="margin-bottom: 15px;" data-translate="follow-movement">Follow the movement:</p>
                        <iframe class="demo-video" src="https://www.youtube.com/embed/uLVt6u15L98" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                </div>
                
                <div class="set-info" id="setInfo" data-translate="set-info">Set 1 of 2</div>
                <div class="exercise-counter" id="exerciseCounter">0</div>
                <div class="target-info" id="targetInfo" data-translate="target">Target: 3</div>
                <div class="exercise-status" id="exerciseStatus" data-translate="get-ready">Get ready...</div>
                <div class="rest-timer" id="restTimer" style="display: none;" data-translate="rest-timer">Rest: 5</div>
                <div class="completion-message" id="completionMessage" data-translate="set-completed">🎉 SET COMPLETED! 🎉</div>
                <div class="video-container">
                    <video id="videoElement" autoplay muted playsinline></video>
                    <canvas id="canvas"></canvas>
                </div>
            </div>
        </div>
        
        <div class="congratulations" id="congratulations">
            <div class="congrats-content">
                <div class="congrats-title" data-translate="amazing">🎉 AMAZING! 🎉</div>
                <h2 data-translate="completed-all-tasks">You completed all tasks for today!</h2>
                <p style="margin: 20px 0; font-size: 18px;" data-translate="keep-work">Keep up the incredible work! Your streak continues.</p>
                <button class="btn primary-btn" onclick="returnToMain()" data-translate="continue-journey">🚀 Continue Journey</button>
            </div>
        </div>
    </div>

    <script>
        // Audio context for haptic and sound feedback
        let audioContext = null;
        let speechSynthesis = window.speechSynthesis;
        
        // Initialize audio context on first user interaction
        function initAudioContext() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }
        
        // Haptic feedback function
        function triggerHapticFeedback(type = 'light') {
            initAudioContext();
            
            if (navigator.vibrate) {
                switch(type) {
                    case 'light':
                        navigator.vibrate(50);
                        break;
                    case 'medium':
                        navigator.vibrate(100);
                        break;
                    case 'heavy':
                        navigator.vibrate([100, 50, 100]);
                        break;
                    case 'success':
                        navigator.vibrate([100, 50, 100, 50, 200]);
                        break;
                }
            }
        }
        
        // Enhanced audio feedback function with different sounds
        function playAudioFeedback(type = 'click') {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            switch(type) {
                case 'click':
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                    break;
                case 'success':
                    // More validating success sound with multiple tones
                    oscillator.frequency.setValueAtTime(523, audioContext.currentTime); // C5
                    oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.15); // E5
                    oscillator.frequency.setValueAtTime(784, audioContext.currentTime + 0.3); // G5
                    oscillator.frequency.setValueAtTime(1047, audioContext.currentTime + 0.45); // C6
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.8);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.8);
                    break;
                case 'whistle':
                    // Whistle sound for rest timer end
                    oscillator.frequency.setValueAtTime(2000, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(2500, audioContext.currentTime + 0.1);
                    oscillator.frequency.exponentialRampToValueAtTime(2000, audioContext.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;
                case 'error':
                    oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;
            }
        }

        // Text-to-speech function for task content
        function speakTaskContent(taskNumber) {
            triggerHapticFeedback('light');
            playAudioFeedback('click');
            
            if (!speechSynthesis) {
                alert('Speech synthesis not supported in this browser');
                return;
            }
            
            // Stop any current speech
            speechSynthesis.cancel();
            
            let textToSpeak = '';
            const lang = currentLanguage === 'mr' ? 'hi-IN' : 'en-US';
            
            switch(taskNumber) {
                case 1:
                    textToSpeak = currentLanguage === 'mr' ? 
                        'दोन सौ मीटर धावणे. आपल्या गतीने धावा.' :
                        'Two hundred meter run. Run at your own pace.';
                    break;
                case 2:
                    textToSpeak = currentLanguage === 'mr' ? 
                        'स्क्वॅट्स. दोन सेट. तीन रेप्स प्रत्येक सेट. पाच सेकंड विश्रांती घ्या.' :
                        'Squats. Two sets. Three reps each set.  With 5 seconds rest.';
                    break;
                case 3:
                    textToSpeak = currentLanguage === 'mr' ? 
                        'जंपिंग जॅक्स. दोन सेट. तीन रेप्स प्रत्येक सेट. पाच सेकंड विश्रांती घ्या.' :
                        'Jumping Jacks. Two sets. Three reps each set. With 5 seconds rest.';
                    break;
                case 4:
                    textToSpeak = currentLanguage === 'mr' ? 
                        'पाणी सेवन. दिवसभर तीन लिटर पाणी प्या.' :
                        'Water intake. Drink three liters of water throughout the day.';
                    break;
            }
            
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = lang;
            utterance.rate = 0.9;
            utterance.pitch = 1.0;
            utterance.volume = 0.8;
            
            speechSynthesis.speak(utterance);
        }

        // Language translations
        const translations = {
            en: {
                "fitness-journey": "FITNESS JOURNEY",
                "tagline": "Your 30-Day Transformation Challenge",
                "days-completed": "Days Completed",
                "current-streak": "Current Streak",
                "total-activities": "Total Activities",
                "overall-progress": "Overall Progress",
                "journey-path": "Your Fitness Journey Path",
                "transforming-lives": "Transforming Lives Through Fitness",
                "back-journey": "← Back to Journey",
                "tasks-complete": "0/4 Tasks Complete",
                "hello-yatin": "Hello Yatin! 👋",
                "todays-plan": "Here's your plan for {date}",
                "speak-task": "🔊 Listen",
                "runs-title": "🏃‍♂️ 200m Run",
                "runs-info": "Run 5 rounds of 200-meters",
                "runs-desc": "Run 200 meters at your own pace. Focus on maintaining good form and breathing rhythm.",
                "squats-title": "🦵 Squats",
                "squats-info": "2 sets × 3 reps • AI tracking",
                "squats-desc": "Perform squats with proper form. Our AI will track your movement and count reps automatically.",
                "jumping-jacks-title": "🤸‍♂️ Jumping Jacks",
                "jumping-jacks-info": "2 sets × 3 reps • AI tracking",
                "jumping-jacks-desc": "Do jumping jacks with arms and legs moving together. AI will detect and count your movements.",
                "water-title": "💧 Water Intake",
                "water-info": "3 liters throughout the day",
                "water-desc": "Stay hydrated by drinking water regularly. Aim for 3 liters spread throughout the day.",
                "start-camera": "📹 Start",
                "manual-complete": "Manual ✓",
                "mark-complete": "✓ Mark Complete",
                "exercise-counter": "Exercise Counter",
                "follow-movement": "Follow the movement:",
                "set-info": "Set 1 of 2",
                "target": "Target: 3",
                "get-ready": "Get ready...",
                "rest-timer": "Rest: 5",
                "set-completed": "🎉 SET COMPLETED! 🎉",
                "amazing": "🎉 AMAZING! 🎉",
                "completed-all-tasks": "You completed all tasks for today!",
                "keep-work": "Keep up the incredible work! Your streak continues.",
                "continue-journey": "🚀 Continue Journey",
                "day": "Day",
                "today-is": "Today is",
                "ready-goals": "Ready to crush your fitness goals?"
            },
            mr: {
                "fitness-journey": "फिटनेस प्रवास",
                "tagline": "तुमची ३० दिवसांची परिवर्तन आव्हान",
                "days-completed": "पूर्ण झालेले दिवस",
                "current-streak": "सद्याची स्ट्रीक",
                "total-activities": "एकूण क्रियाकलाप",
                "overall-progress": "एकूण प्रगती",
                "journey-path": "तुमचा फिटनेस प्रवासाचा मार्ग",
                "transforming-lives": "फिटनेसच्या माध्यमातून जीवन बदलणे",
                "back-journey": "← प्रवासाकडे परत",
                "tasks-complete": "०/४ कार्य पूर्ण",
                "hello-yatin": "नमस्कार यतीन! 👋",
                "todays-plan": "आजची तुमची योजना {date}",
                "speak-task": "🔊 ऐका",
                "runs-title": "🏃‍♂️ २०० मीटर धावणे",
                "runs-info": "२०० मीटर चे ५ राऊंड धावा",
                "runs-desc": "आपल्या गतीने २०० मीटर धावा. योग्य फॉर्म आणि श्वासोच्छवासावर लक्ष ठेवा.",
                "squats-title": "🦵 स्क्वॅट्स",
                "squats-info": "२ सेट × ३ रेप्स • AI ट्रॅकिंग",
                "squats-desc": "योग्य पद्धतीने स्क्वॅट्स करा. आमचे AI तुमची हालचाल ट्रॅक करेल आणि रेप्स गणणा करेल.",
                "jumping-jacks-title": "🤸‍♂️ जंपिंग जॅक्स",
                "jumping-jacks-info": "२ सेट × ३ रेप्स • AI ट्रॅकिंग",
                "jumping-jacks-desc": "हात आणि पाय एकत्र हलवून जंपिंग जॅक्स करा. AI तुमची हालचाल शोधेल आणि गणणा करेल.",
                "water-title": "💧 पाणी सेवन",
                "water-info": "दिवसभर ३ लिटर",
                "water-desc": "नियमितपणे पाणी प्यून हायड्रेटेड रहा. दिवसभर ३ लिटर पाणी प्याचे लक्ष्य ठेवा.",
                "start-camera": "📹 सुरू करा",
                "manual-complete": "मॅन्युअल ✓",
                "mark-complete": "✓ पूर्ण करा",
                "exercise-counter": "व्यायाम काउंटर",
                "follow-movement": "हालचाल फॉलो करा:",
                "set-info": "सेट १ पैकी २",
                "target": "लक्ष्य: ३",
                "get-ready": "तयार व्हा...",
                "rest-timer": "विश्रांती: ५",
                "set-completed": "🎉 सेट पूर्ण! 🎉",
                "amazing": "🎉 छान! 🎉",
                "completed-all-tasks": "तुम्ही आजची सर्व कार्ये पूर्ण केलीत!",
                "keep-work": "असेच चालू ठेवा! तुमची स्ट्रीक चालू आहे.",
                "continue-journey": "🚀 प्रवास चालू ठेवा",
                "day": "दिवस",
                "today-is": "आज",
                "ready-goals": "तुमची फिटनेस लक्ष्ये साध्य करण्यास तयार आहात?"
            }
        };
        
        let currentLanguage = 'en';
        
        // Use regular variables instead of localStorage
        let progressData = {};
        let currentDay = 1;
        let selectedDay = 1;
        
        // Fitness tracker variables
        let currentExercise = null, targetCount = 0, exerciseCount = 0, taskToComplete = 0;
        let totalSets = 0, currentSet = 1, repsPerSet = 0;
        let pose, camera, recognition, voiceInterval;
        let hasGoneDown = false, armsUp = false, legsApart = false, hasCompletedJump = false;
        let tasksCompleted = [false, false, false, false];
        let isResting = false, restTimer = null;
        
        let exerciseSets = { 2: [false, false], 3: [false, false] }; // Track sets for squats and jumping jacks
        
        // Add click sound to all interactive elements
        document.addEventListener('click', function(e) {
            if (e.target.matches('button, .btn, .lang-btn, .day-milestone:not(.locked)')) {
                triggerHapticFeedback('light');
                playAudioFeedback('click');
            }
        });
        
        function setLanguage(lang) {
            currentLanguage = lang;
            
            triggerHapticFeedback('light');
            playAudioFeedback('click');
            
            // Update active language buttons
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('langEn').classList.toggle('active', lang === 'en');
            document.getElementById('langMr').classList.toggle('active', lang === 'mr');
            document.getElementById('taskLangEn').classList.toggle('active', lang === 'en');
            document.getElementById('taskLangMr').classList.toggle('active', lang === 'mr');
            
            // Translate all elements
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[lang][key]) {
                    if (key === 'todays-plan') {
                        element.textContent = translations[lang][key].replace('{date}', getFormattedDate());
                    } else {
                        element.textContent = translations[lang][key];
                    }
                }
            });
            
            // Update today's date and progress text
            updateTodayDisplay();
            updateProgressText();
        }
        
        function updateTodayDisplay() {
            const todayText = currentLanguage === 'mr' ? 'आज' : 'Today is';
            const readyText = currentLanguage === 'mr' ? 'तुमची फिटनेस लक्ष्ये साध्य करण्यास तयार आहात?' : 'Ready to crush your fitness goals?';
            
            document.getElementById('todayDate').textContent = `${todayText} ${getFormattedDate()}`;
            document.getElementById('todayDay').textContent = readyText;
        }
        
        function updateProgressText() {
            const completed = tasksCompleted.filter(task => task).length;
            const progressText = currentLanguage === 'en' ? `${completed}/4 Tasks Complete` : `${completed}/४ कार्य पूर्ण`;
            document.getElementById('floatingProgressText').textContent = progressText;
        }
        
        function getGreeting() {
            const hour = new Date().getHours();
            if (currentLanguage === 'mr') {
                if (hour < 12) return "सुप्रभात";
                if (hour < 17) return "नमस्कार";
                return "शुभ संध्या";
            } else {
                if (hour < 12) return "Good Morning";
                if (hour < 17) return "Good Afternoon";
                return "Good Evening";
            }
        }
        
        function getFormattedDate() {
            const now = new Date();
            if (currentLanguage === 'mr') {
                const days = ['रविवार', 'सोमवार', 'मंगळवार', 'बुधवार', 'गुरुवार', 'शुक्रवार', 'शनिवार'];
                const months = ['जानेवारी', 'फेब्रुवारी', 'मार्च', 'एप्रिल', 'मे', 'जून', 'जुलै', 'ऑगस्ट', 'सप्टेंबर', 'ऑक्टोबर', 'नोव्हेंबर', 'डिसेंबर'];
                return `${days[now.getDay()]}, ${months[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}`;
            } else {
                const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
                const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                return `${days[now.getDay()]}, ${months[now.getMonth()]} ${now.getDate()}, ${now.getFullYear()}`;
            }
        }
        
        function initializeProgress() {
            const pathGrid = document.getElementById('pathGrid');
            pathGrid.innerHTML = '';
            
            for (let day = 1; day <= 7; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'day-milestone';
                
                const dayData = progressData[day] || { completed: false, progress: 0 };
                
                if (dayData.completed) {
                    dayElement.classList.add('completed');
                } else if (day === currentDay) {
                    dayElement.classList.add('current');
                } else if (day > currentDay) {
                    dayElement.classList.add('locked');
                }
                
                const circumference = 2 * Math.PI * 12;
                const strokeDasharray = `${(dayData.progress / 100) * circumference} ${circumference}`;
                
                const dayText = currentLanguage === 'mr' ? 'दिवस' : 'Day';
                
                dayElement.innerHTML = `
                    <div class="day-number">${dayText} ${day}</div>
                    <div class="day-progress-text">${Math.round(dayData.progress)}% ${currentLanguage === 'mr' ? 'पूर्ण' : 'Complete'}</div>
                    <svg class="day-progress-ring">
                        <circle cx="15" cy="15" r="12" stroke="#3b82f6" stroke-width="2" fill="transparent" 
                                stroke-dasharray="${strokeDasharray}" stroke-dashoffset="0" 
                                transform="rotate(-90 15 15)" stroke-linecap="round"/>
                    </svg>
                `;
                
                if (!dayElement.classList.contains('locked')) {
                    dayElement.addEventListener('click', () => {
                        triggerHapticFeedback('medium');
                        playAudioFeedback('click');
                        startDay(day);
                    });
                }
                
                pathGrid.appendChild(dayElement);
            }
            
            updateMainStats();
        }
        
        function updateMainStats() {
            const completedDays = Object.values(progressData).filter(day => day.completed).length;
            const totalActivities = Object.values(progressData).reduce((sum, day) => sum + (day.activitiesCompleted || 0), 0);
            const overallProgress = Math.round((completedDays / 7) * 100);
            
            let streak = 0;
            for (let day = currentDay - 1; day >= 1; day--) {
                if (progressData[day] && progressData[day].completed) {
                    streak++;
                } else {
                    break;
                }
            }
            
            document.getElementById('totalDaysCompleted').textContent = completedDays;
            document.getElementById('currentStreakDisplay').textContent = streak;
            document.getElementById('totalActivitiesDisplay').textContent = totalActivities;
            document.getElementById('completionPercentage').textContent = `${overallProgress}%`;
        }
        
        function startDay(day) {
            if (day > currentDay) return;
            
            selectedDay = day;
            const dayData = progressData[day] || { completed: false, progress: 0, tasksCompleted: [false, false, false, false] };
            tasksCompleted = dayData.tasksCompleted || [false, false, false, false];
            
            exerciseSets = dayData.exerciseSets || { 2: [false, false], 3: [false, false] };
            
            document.getElementById('progressPage').style.display = 'none';
            document.getElementById('fitnessTracker').style.display = 'block';
            
            // Update greeting and date
            const greeting = getGreeting();
            const greetingText = currentLanguage === 'mr' ? `${greeting}, यतीन! 👋` : `${greeting}, Yatin! 👋`;
            const planText = currentLanguage === 'mr' ? `आजची तुमची योजना ${getFormattedDate()}` : `Here's your plan for ${getFormattedDate()}`;
            
            document.querySelector('[data-translate="hello-yatin"]').textContent = greetingText;
            document.getElementById('planText').textContent = planText;
            
            updateFitnessUI();
        }
        
        function updateFitnessUI() {
            const completed = tasksCompleted.filter(task => task).length;
            const progress = (completed / 4) * 100;
            
            document.getElementById('floatingProgressBar').style.width = `${progress}%`;
            updateProgressText();
            
            tasksCompleted.forEach((completed, index) => {
                const taskCard = document.getElementById(`task${index + 1}`);
                const statusIcon = document.getElementById(`status${index + 1}`);
                
                if (completed) {
                    taskCard.classList.add('completed');
                    statusIcon.textContent = '✓';
                    statusIcon.classList.add('completed');
                } else {
                    taskCard.classList.remove('completed');
                    statusIcon.textContent = '○';
                    statusIcon.classList.remove('completed');
                }
            });
            
            // Update set trackers for exercises with sets
            updateSetTracker(2, exerciseSets[2]);
            updateSetTracker(3, exerciseSets[3]);
        }
        
        function updateSetTracker(taskIndex, setsArray) {
            setsArray.forEach((completed, setIndex) => {
                const dot = document.getElementById(`set${taskIndex}-${setIndex + 1}`);
                if (dot) {
                    dot.className = 'set-dot';
                    if (completed) {
                        dot.classList.add('completed');
                    }
                }
            });
        }
        
        function markTaskComplete(taskNumber) {
            triggerHapticFeedback('success');
            playAudioFeedback('success');
            
            tasksCompleted[taskNumber - 1] = true;
            
            // Add success animation
            const taskCard = document.getElementById(`task${taskNumber}`);
            taskCard.classList.add('success-animation');
            setTimeout(() => taskCard.classList.remove('success-animation'), 600);
            
            updateFitnessUI();
            checkAllTasksComplete();
        }
        
        function checkAllTasksComplete() {
            if (tasksCompleted.every(task => task)) {
                // Show congratulations message after a brief delay
                setTimeout(() => {
                    document.getElementById('congratulations').style.display = 'flex';
                }, 1000);
            }
        }
        
        function returnToMain() {
            triggerHapticFeedback('medium');
            playAudioFeedback('click');
            
            const completedCount = tasksCompleted.filter(task => task).length;
            const progress = (completedCount / 4) * 100;
            const isCompleted = completedCount === 4;
            
            progressData[selectedDay] = {
                completed: isCompleted,
                progress: progress,
                activitiesCompleted: completedCount,
                tasksCompleted: tasksCompleted,
                exerciseSets: exerciseSets
            };
            
            // If current day is completed, unlock next day
            if (isCompleted && selectedDay === currentDay) {
                currentDay++;
            }
            
            document.getElementById('fitnessTracker').style.display = 'none';
            document.getElementById('progressPage').style.display = 'block';
            document.getElementById('congratulations').style.display = 'none';
            
            if (camera) {
                camera.stop();
                camera = null;
            }
            
            initializeProgress();
        }
        
        function startExercise(exercise, reps, sets, taskNum) {
            triggerHapticFeedback('medium');
            playAudioFeedback('click');
            
            currentExercise = exercise;
            repsPerSet = reps;
            totalSets = sets;
            currentSet = 1;
            taskToComplete = taskNum;
            actuallyStartExercise();
        }
        
        function actuallyStartExercise() {
            exerciseCount = 0;
            hasGoneDown = false;
            armsUp = false;
            legsApart = false;
            hasCompletedJump = false;
            isResting = false;
            
            const exerciseTitle = currentExercise === 'squats' ? 
                (currentLanguage === 'mr' ? '🦵 स्क्वॅट काउंटर' : '🦵 Squat Counter') :
                (currentLanguage === 'mr' ? '🤸‍♂️ जंपिंग जॅक काउंटर' : '🤸‍♂️ Jumping Jacks Counter');
            
            document.getElementById('exerciseTitle').textContent = exerciseTitle;
            
            const setInfoText = currentLanguage === 'mr' ? 
                `सेट ${currentSet} पैकी ${totalSets}` : 
                `Set ${currentSet} of ${totalSets}`;
            document.getElementById('setInfo').textContent = setInfoText;
            
            const targetText = currentLanguage === 'mr' ? 
                `लक्ष्य: ${repsPerSet}` : 
                `Target: ${repsPerSet}`;
            document.getElementById('targetInfo').textContent = targetText;
            
            document.getElementById('exerciseCounter').textContent = '0';
            
            const statusText = currentLanguage === 'mr' ? 'कॅमेरा सुरू करत आहे...' : 'Starting camera...';
            document.getElementById('exerciseStatus').textContent = statusText;
            
            document.getElementById('completionMessage').style.display = 'none';
            document.getElementById('restTimer').style.display = 'none';
            document.getElementById('cameraSection').style.display = 'block';
            
            // Show demo videos
            document.getElementById('squatDemo').style.display = currentExercise === 'squats' ? 'block' : 'none';
            document.getElementById('jumpingJackDemo').style.display = currentExercise === 'jumping-jacks' ? 'block' : 'none';
            
            startCamera();
        }
        
        function startCamera() {
            // Wait for MediaPipe libraries to load with improved error handling
            let checkInterval = setInterval(() => {
                if (typeof Pose !== 'undefined' && typeof Camera !== 'undefined') {
                    clearInterval(checkInterval);
                    initializeCamera();
                }
            }, 100);
            
            // Timeout after 10 seconds if libraries don't load
            setTimeout(() => {
                if (typeof Pose === 'undefined' || typeof Camera === 'undefined') {
                    clearInterval(checkInterval);
                    const errorText = currentLanguage === 'mr' ? 
                        'AI मॉडेल लोड होऊ शकले नाही. कृपया मॅन्युअल पूर्ण करा.' : 
                        'AI model failed to load. Please use manual completion.';
                    document.getElementById('exerciseStatus').textContent = errorText;
                }
            }, 10000);
        }
        
        function initializeCamera() {
            const loadingText = currentLanguage === 'mr' ? 'AI मॉडेल लोड करत आहे...' : 'Loading AI model...';
            document.getElementById('exerciseStatus').textContent = loadingText;

            pose = new Pose({
                locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
            });
            
            pose.setOptions({
                modelComplexity: 1,
                smoothLandmarks: true,
                enableSegmentation: false,
                minDetectionConfidence: 0.5,
                minTrackingConfidence: 0.5
            });
            
            pose.onResults(onResults);
            
            const videoElement = document.getElementById('videoElement');
            camera = new Camera(videoElement, {
                onFrame: async () => { 
                    if (pose && !isResting) await pose.send({image: videoElement}); 
                },
                width: 640,
                height: 480
            });
            
            camera.start()
                .then(() => {
                    const startedText = currentLanguage === 'mr' ? 
                        'कॅमेरा सुरू झाला! व्यायाम सुरू करा! 💪' : 
                        'Camera started! Begin exercising! 💪';
                    document.getElementById('exerciseStatus').textContent = startedText;
                })
                .catch(() => {
                    const unavailableText = currentLanguage === 'mr' ? 
                        'कॅमेरा उपलब्ध नाही. कृपया मॅन्युअल पूर्ण करा.' : 
                        'Camera unavailable. Please try manual completion.';
                    document.getElementById('exerciseStatus').textContent = unavailableText;
                });
        }
        
        function startRestTimer() {
            isResting = true;
            let restTime = 5;
            document.getElementById('restTimer').style.display = 'block';
            
            const restTimerText = currentLanguage === 'mr' ? 
                `विश्रांती: ${restTime}` : 
                `Rest: ${restTime}`;
            document.getElementById('restTimer').textContent = restTimerText;
            
            const restStatusText = currentLanguage === 'mr' ? 
                '५ सेकंद विश्रांती घ्या!' : 
                'Take a 5-second break!';
            document.getElementById('exerciseStatus').textContent = restStatusText;
            
            restTimer = setInterval(() => {
                restTime--;
                const timerText = currentLanguage === 'mr' ? 
                    `विश्रांती: ${restTime}` : 
                    `Rest: ${restTime}`;
                document.getElementById('restTimer').textContent = timerText;
                
                if (restTime <= 0) {
                    clearInterval(restTimer);
                    document.getElementById('restTimer').style.display = 'none';
                    isResting = false;
                    exerciseCount = 0;
                    currentSet++;
                    
                    // Play whistle sound when rest time ends
                    playAudioFeedback('whistle');
                    triggerHapticFeedback('medium');
                    
                    if (currentSet <= totalSets) {
                        const setInfoText = currentLanguage === 'mr' ? 
                            `सेट ${currentSet} पैकी ${totalSets}` : 
                            `Set ${currentSet} of ${totalSets}`;
                        document.getElementById('setInfo').textContent = setInfoText;
                        document.getElementById('exerciseCounter').textContent = '0';
                        
                        const continueText = currentLanguage === 'mr' ? 
                            'पुढच्या सेटसह चालू ठेवा! 💪' : 
                            'Continue with next set! 💪';
                        document.getElementById('exerciseStatus').textContent = continueText;
                        document.getElementById('completionMessage').style.display = 'none';
                    }
                }
            }, 1000);
        }
        
        function closeCamera() {
            triggerHapticFeedback('light');
            playAudioFeedback('click');
            
            document.getElementById('cameraSection').style.display = 'none';
            if (camera) {
                camera.stop();
                camera = null;
            }
            if (restTimer) {
                clearInterval(restTimer);
                restTimer = null;
            }
        }
        
        function playBeep() {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.2);
        }
        
        function calculateAngle(a, b, c) {
            const radians = Math.atan2(c.y - b.y, c.x - b.x) - Math.atan2(a.y - b.y, a.x - b.x);
            let angle = Math.abs(radians * 180.0 / Math.PI);
            if (angle > 180.0) angle = 360 - angle;
            return angle;
        }
        
        function detectSquats(results) {
            if (isResting) return;
            
            const landmarks = results.poseLandmarks;
            const leftHip = landmarks[23], leftKnee = landmarks[25], leftAnkle = landmarks[27];
            const rightHip = landmarks[24], rightKnee = landmarks[26], rightAnkle = landmarks[28];
            
            if (![leftHip, leftKnee, leftAnkle, rightHip, rightKnee, rightAnkle].every(part => part && part.visibility > 0.5)) {
                const statusText = currentLanguage === 'mr' ? 
                    'मागे जा आणि तुमचे संपूर्ण शरीर दाखवा' : 
                    'Step back and show your full body';
                document.getElementById('exerciseStatus').textContent = statusText;
                return;
            }
            
            const leftKneeAngle = calculateAngle(leftHip, leftKnee, leftAnkle);
            const rightKneeAngle = calculateAngle(rightHip, rightKnee, rightAnkle);
            const bothKneesBent = leftKneeAngle < 120 && rightKneeAngle < 120;
            const bothKneesUp = leftKneeAngle > 150 && rightKneeAngle > 150;
            
            if (bothKneesBent && !hasGoneDown) {
                hasGoneDown = true;
                const downText = currentLanguage === 'mr' ? 
                    'खाली जात आहे... परफेक्ट! 💪' : 
                    'Going down... Perfect! 💪';
                document.getElementById('exerciseStatus').textContent = downText;
            } else if (bothKneesUp && hasGoneDown) {
                hasGoneDown = false;
                exerciseCount++;
                document.getElementById('exerciseCounter').textContent = exerciseCount;
                
                triggerHapticFeedback('medium');
                playBeep();
                
                if (exerciseCount >= repsPerSet) {
                    const completedText = currentLanguage === 'mr' ? 
                        '🎉 सेट पूर्ण! 🎉' : 
                        '🎉 SET COMPLETED! 🎉';
                    document.getElementById('exerciseStatus').textContent = completedText;
                    document.getElementById('completionMessage').style.display = 'block';
                    
                    // Update exercise sets
                    exerciseSets[taskToComplete][currentSet - 1] = true;
                    updateSetTracker(taskToComplete, exerciseSets[taskToComplete]);
                    
                    if (currentSet >= totalSets) {
                        // All sets completed
                        triggerHapticFeedback('success');
                        playAudioFeedback('success');
                        
                        const allCompletedText = currentLanguage === 'mr' ? 
                            '🎉 सर्व सेट्स पूर्ण! छान काम! 🎉' : 
                            '🎉 ALL SETS COMPLETED! AMAZING WORK! 🎉';
                        document.getElementById('exerciseStatus').textContent = allCompletedText;
                        markTaskComplete(taskToComplete);
                        setTimeout(() => closeCamera(), 3000);
                    } else {
                        // Start rest timer for next set
                        setTimeout(() => startRestTimer(), 1000);
                    }
                } else {
                    const remainingText = currentLanguage === 'mr' ? 
                        `आणखी ${repsPerSet - exerciseCount} स्क्वॅट्स! 🔥` : 
                        `${repsPerSet - exerciseCount} more squats! 🔥`;
                    document.getElementById('exerciseStatus').textContent = remainingText;
                }
            }
        }
        
        function detectJumpingJacks(results) {
            if (isResting) return;
            
            const landmarks = results.poseLandmarks;
            const leftShoulder = landmarks[11], rightShoulder = landmarks[12];
            const leftWrist = landmarks[15], rightWrist = landmarks[16];
            const leftAnkle = landmarks[27], rightAnkle = landmarks[28];
            
            if (![leftShoulder, rightShoulder, leftWrist, rightWrist, leftAnkle, rightAnkle].every(part => part && part.visibility > 0.5)) {
                const statusText = currentLanguage === 'mr' ? 
                    'मागे जा आणि तुमचे संपूर्ण शरीर दाखवा' : 
                    'Step back and show your full body';
                document.getElementById('exerciseStatus').textContent = statusText;
                return;
            }
            
            const currentArmsUp = leftWrist.y < leftShoulder.y && rightWrist.y < rightShoulder.y;
            const ankleDistance = Math.abs(leftAnkle.x - rightAnkle.x);
            const shoulderDistance = Math.abs(leftShoulder.x - rightShoulder.x);
            const currentLegsApart = ankleDistance > shoulderDistance * 1.5;
            
            if (currentArmsUp && currentLegsApart && !hasCompletedJump) {
                armsUp = true;
                legsApart = true;
                const perfectText = currentLanguage === 'mr' ? 
                    'परफेक्ट पोजिशन! 🙌' : 
                    'Perfect position! 🙌';
                document.getElementById('exerciseStatus').textContent = perfectText;
            } else if (!currentArmsUp && !currentLegsApart && armsUp && legsApart) {
                hasCompletedJump = true;
                armsUp = false;
                legsApart = false;
                exerciseCount++;
                document.getElementById('exerciseCounter').textContent = exerciseCount;
                
                triggerHapticFeedback('medium');
                playBeep();
                
                if (exerciseCount >= repsPerSet) {
                    const completedText = currentLanguage === 'mr' ? 
                        '🎉 सेट पूर्ण! 🎉' : 
                        '🎉 SET COMPLETED! 🎉';
                    document.getElementById('exerciseStatus').textContent = completedText;
                    document.getElementById('completionMessage').style.display = 'block';
                    
                    // Update exercise sets
                    exerciseSets[taskToComplete][currentSet - 1] = true;
                    updateSetTracker(taskToComplete, exerciseSets[taskToComplete]);
                    
                    if (currentSet >= totalSets) {
                        // All sets completed
                        triggerHapticFeedback('success');
                        playAudioFeedback('success');
                        
                        const allCompletedText = currentLanguage === 'mr' ? 
                            '🎉 सर्व सेट्स पूर्ण! छान काम! 🎉' : 
                            '🎉 ALL SETS COMPLETED! AMAZING WORK! 🎉';
                        document.getElementById('exerciseStatus').textContent = allCompletedText;
                        markTaskComplete(taskToComplete);
                        setTimeout(() => closeCamera(), 3000);
                    } else {
                        // Start rest timer for next set
                        setTimeout(() => startRestTimer(), 1000);
                    }
                } else {
                    const remainingText = currentLanguage === 'mr' ? 
                        `आणखी ${repsPerSet - exerciseCount} जंपिंग जॅक्स! 🔥` : 
                        `${repsPerSet - exerciseCount} more jumping jacks! 🔥`;
                    document.getElementById('exerciseStatus').textContent = remainingText;
                }
                
                setTimeout(() => { hasCompletedJump = false; }, 500);
            }
        }
        
        function onResults(results) {
            const canvas = document.getElementById('canvas');
            const canvasCtx = canvas.getContext('2d');
            const video = document.getElementById('videoElement');
            
            // Set canvas size to match video
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            // Clear canvas
            canvasCtx.save();
            canvasCtx.clearRect(0, 0, canvas.width, canvas.height);
            
            if (results.poseLandmarks) {
                // Draw pose landmarks and connections with improved visibility
                if (typeof drawConnectors !== 'undefined' && typeof POSE_CONNECTIONS !== 'undefined') {
                    drawConnectors(canvasCtx, results.poseLandmarks, POSE_CONNECTIONS, {
                        color: '#10b981', 
                        lineWidth: 4
                    });
                }
                
                // Draw landmarks on top
                if (typeof drawLandmarks !== 'undefined') {
                    drawLandmarks(canvasCtx, results.poseLandmarks, {
                        color: '#3b82f6', 
                        lineWidth: 2, 
                        radius: 6,
                        fillColor: '#3b82f6'
                    });
                }
                
                // Detect exercises
                if (currentExercise === 'squats') {
                    detectSquats(results);
                } else if (currentExercise === 'jumping-jacks') {
                    detectJumpingJacks(results);
                }
            }
            
            canvasCtx.restore();
        }
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initAudioContext();
            
            // Set Main Page as landing page (show progressPage by default)
            document.getElementById('progressPage').style.display = 'block';
            document.getElementById('fitnessTracker').style.display = 'none';
            
            initializeProgress();
            setLanguage('en'); // Set default language
            updateTodayDisplay();
        });
        
        // Initialize audio context on first user interaction
        document.addEventListener('click', initAudioContext, { once: true });
        document.addEventListener('touchstart', initAudioContext, { once: true });
    </script>
</body>
</html>
